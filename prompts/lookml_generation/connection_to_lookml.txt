CONNECTION_DSL_TO_LOOKML_PROMPT = """
You are a Looker LookML generator that converts Connection DSL into a LookML model file.

INPUT: Connection DSL in this format:

DS:<dataset_name> | CONN:<connection_type>.<database>.<schema>

TABLES:
<table_name>|alias:<alias>|type:<table|view|custom_sql>

JOINS:
<left_table>.<left_key> = <right_table>.<right_key>|type:<join_type>

OUTPUT: LookML model file (`<model_name>.model.lkml`)

---

STEP 1: EXTRACT CONNECTION INFORMATION

From the DSL CONN: line:
- Extract connection_type (bigquery, snowflake, redshift, postgres, mysql, mssql, oracle)
- Extract database name
- Extract schema name

The connection name in LookML should match the connection_type, or use a predefined connection name.

---

STEP 2: GENERATE MODEL FILE STRUCTURE

**IMPORTANT: Model file naming and handling**
- Use standard naming: Extract dataset name from DSL (DS:<dataset_name>)
- Normalize dataset name to snake_case for file name
- File format: `models/<normalized_dataset_name>.model.lkml`
- If model file already exists, this will be the base structure (explores will be appended later)

```lkml
connection: "<connection_name>"

include: "/views/*.view.lkml"

# Explores will be generated from worksheets and appended to this file
# This model file sets up the base connection and includes all views
```

---

STEP 3: CONNECTION NAME MAPPING

| DSL Connection Type | LookML Connection Name | Notes |
|---------------------|------------------------|-------|
| bigquery | bigquery_connection | Use your BigQuery connection name |
| snowflake | snowflake_connection | Use your Snowflake connection name |
| redshift | redshift_connection | Use your Redshift connection name |
| postgres | postgres_connection | Use your PostgreSQL connection name |
| mysql | mysql_connection | Use your MySQL connection name |
| mssql | sqlserver_connection | Use your SQL Server connection name |
| oracle | oracle_connection | Use your Oracle connection name |

**Note:** Replace `<connection_name>` with the actual connection name configured in your Looker instance.

---

STEP 4: TABLE AND JOIN INFORMATION

The TABLES and JOINS sections in the DSL provide metadata about the data model structure.
- This information is used for context when generating explores from worksheets
- The model file itself primarily sets up the connection and includes views
- Explores (which use joins) are generated from worksheet DSL

---

EXAMPLE INPUT:
```
DS:sales_analysis | CONN:bigquery.analytics_db.sales

TABLES:
fct_orders|alias:o|type:table
dim_customers|alias:c|type:table
dim_products|alias:p|type:table

JOINS:
fct_orders.customer_id = dim_customers.id|type:left
fct_orders.product_id = dim_products.id|type:inner
```

EXAMPLE OUTPUT:
```lkml
connection: "bigquery_connection"

include: "/views/*.view.lkml"

# Model: sales_analysis
# Database: analytics_db
# Schema: sales
# 
# Tables:
# - fct_orders (alias: o)
# - dim_customers (alias: c)
# - dim_products (alias: p)
# 
# Joins:
# - fct_orders.customer_id = dim_customers.id (left)
# - fct_orders.product_id = dim_products.id (inner)
```

---

VALIDATION:

Before output, verify:
✅ Connection type extracted correctly
✅ Model file uses valid LookML syntax
✅ Connection name matches your Looker instance configuration
✅ Include statement uses correct path pattern
✅ Comments provide context about the data model

---

CRITICAL RULES:

1. **Connection Name**: Use the actual connection name from your Looker instance, not the DSL connection type
2. **Include Pattern**: Use `/views/*.view.lkml` to include all view files
3. **Comments**: Add helpful comments about the data model structure
4. **Syntax**: All LookML files must be valid and properly formatted

---

NOW CONVERT THE CONNECTION DSL BELOW:

Generate a complete LookML model file with proper connection setup.

"""

